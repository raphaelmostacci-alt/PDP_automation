================================================================================
üìä R√âSUM√â COMPLET DU PROJET PDP_automation
================================================================================
Date : 27 Novembre 2025
Auteur : GitHub Copilot (Assistant IA)

================================================================================
üéØ OBJECTIF PRINCIPAL
================================================================================

Automatiser la v√©rification de conformit√© des documents obligatoires pour les 
entreprises ext√©rieures intervenant dans le laboratoire.

Documents concern√©s :
  ‚Ä¢ CNI (Carte Nationale d'Identit√©) - validit√© 10-15 ans
  ‚Ä¢ Habilitations √âlectriques - validit√© 3 ans
  ‚Ä¢ FDS (Fiches de Donn√©es de S√©curit√©) - ann√©e >= 2021
  ‚Ä¢ Aptitudes Frigorifiques - valides √† vie

================================================================================
üèóÔ∏è ARCHITECTURE TECHNIQUE
================================================================================

Langage : C (ANSI C99)
Compilation : gcc avec makefile
Port : 443 (HTTPS par d√©faut)

Biblioth√®ques requises :
  ‚Ä¢ libcurl - Requ√™tes HTTPS vers API ChatGPT
  ‚Ä¢ cJSON - Parsing des r√©ponses JSON
  ‚Ä¢ Standard C - stdio.h, stdlib.h, string.h, dirent.h, time.h

================================================================================
üìã WORKFLOW G√âN√âRAL
================================================================================

1. ENTR√âE
   ‚îî‚îÄ> Dossier contenant les documents (PDF, JPG, PNG, TIF)

2. SCANNER
   ‚îî‚îÄ> Lister tous les fichiers du dossier
   ‚îî‚îÄ> Compter le nombre total de fichiers
   ‚îî‚îÄ> Filtrer par extension (.pdf, .jpg, .png, .tif)

3. BOUCLE D'ANALYSE
   while (fichiers non trait√©s) {
       ‚îú‚îÄ> Ouvrir le fichier courant
       ‚îú‚îÄ> Envoyer √† l'API ChatGPT (HTTPS:443)
       ‚îÇ   ‚îî‚îÄ> URL : https://chat.st.com
       ‚îú‚îÄ> Recevoir r√©ponse JSON de l'IA
       ‚îú‚îÄ> Parser le JSON (extraire infos)
       ‚îú‚îÄ> Appliquer r√®gles de validation
       ‚îú‚îÄ> √âcrire r√©sultat dans CSV
       ‚îî‚îÄ> Fermer le fichier et passer au suivant
   }

4. SORTIE
   ‚îî‚îÄ> Fichier CSV : rapport_pdp_YYYYMMDD.csv
   ‚îî‚îÄ> Sauvegarde dans data/output/
   ‚îî‚îÄ> Affichage statistiques en console

================================================================================
üóÇÔ∏è STRUCTURE MODULAIRE DU PROJET
================================================================================

PDP_automation/
‚îú‚îÄ‚îÄ main.c                    # Fonction main(), orchestration g√©n√©rale
‚îú‚îÄ‚îÄ document_scanner.c/h      # Scanner de dossier, comptage fichiers
‚îú‚îÄ‚îÄ chatgpt_client.c/h        # Communication API ChatGPT (libcurl, HTTPS:443)
‚îú‚îÄ‚îÄ json_parser.c/h           # Parser les r√©ponses JSON de l'IA
‚îú‚îÄ‚îÄ validator.c/h             # R√®gles de validation m√©tier
‚îú‚îÄ‚îÄ excel_generator.c/h       # G√©n√©ration du rapport CSV
‚îú‚îÄ‚îÄ config.h                  # Constantes (URL API, r√®gles de validit√©)
‚îú‚îÄ‚îÄ makefile                  # Compilation avec gcc
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ input/                # Documents √† analyser
‚îÇ   ‚îî‚îÄ‚îÄ output/               # Rapports CSV g√©n√©r√©s
‚îî‚îÄ‚îÄ README.md                 # Documentation du projet

================================================================================
üìä STRUCTURES DE DONN√âES
================================================================================

typedef struct {
    char entreprise[100];
    char nom[50];
    char prenom[50];
    char type_document[30];      // CNI, HABILITATION, FDS, APTITUDE_FRIGO
    char chemin_fichier[256];
    char date_validite[20];
    char statut[20];             // "CONFORME" ou "NON_CONFORME"
    char commentaire[200];
} Document;

typedef struct {
    int total_fichiers;
    int fichiers_conformes;
    int fichiers_non_conformes;
    int fichiers_erreur;
} Statistiques;

================================================================================
ü§ñ PROMPTS POUR L'IA (LOIS D'EXTRACTION)
================================================================================

Ces prompts seront envoy√©s √† l'API ChatGPT pour analyser chaque document.

1. PROMPT POUR CNI :
   "Analyse cette Carte Nationale d'Identit√©. Extrait les informations 
    suivantes au format JSON :
    - nom (string)
    - prenom (string)
    - date_naissance (format: YYYY-MM-DD)
    - date_emission (format: YYYY-MM-DD)
    - date_expiration (format: YYYY-MM-DD)
    Si une information n'est pas lisible, retourne 'ILLISIBLE'."

2. PROMPT POUR HABILITATIONS √âLECTRIQUES :
   "Analyse cette Habilitation √âlectrique. Extrait les informations 
    suivantes au format JSON :
    - nom (string)
    - prenom (string)
    - entreprise (string)
    - type_habilitation (string, ex: B0, B1, B2, etc.)
    - date_emission (format: YYYY-MM-DD)
    - date_expiration (format: YYYY-MM-DD)
    Si une information n'est pas lisible, retourne 'ILLISIBLE'."

3. PROMPT POUR FDS (FICHES DE DONN√âES DE S√âCURIT√â) :
   "Analyse cette Fiche de Donn√©es de S√©curit√©. Extrait les informations 
    suivantes au format JSON :
    - nom_produit (string)
    - entreprise (string)
    - annee_edition (integer, YYYY)
    - date_revision (format: YYYY-MM-DD)
    Si une information n'est pas lisible, retourne 'ILLISIBLE'."

4. PROMPT POUR APTITUDES FRIGORIFIQUES :
   "Analyse cette Aptitude Frigorifique. Extrait les informations 
    suivantes au format JSON :
    - nom (string)
    - prenom (string)
    - entreprise (string)
    - numero_certificat (string)
    - date_obtention (format: YYYY-MM-DD)
    Si une information n'est pas lisible, retourne 'ILLISIBLE'."

================================================================================
‚úÖ R√àGLES DE VALIDATION
================================================================================

1. CNI (Carte Nationale d'Identit√©)
   R√®gle : Date d'√©mission < 10 ans (adultes) ou < 15 ans (mineurs)
   Calcul : date_actuelle - date_emission <= dur√©e_validit√©
   Statut : CONFORME / NON_CONFORME / EXPIR√â

2. Habilitations √âlectriques
   R√®gle : Date d'√©mission < 3 ans
   Calcul : date_actuelle - date_emission <= 3 ans
   Statut : CONFORME / NON_CONFORME / EXPIR√â

3. FDS (Fiches de Donn√©es de S√©curit√©)
   R√®gle : Ann√©e d'√©dition >= 2021
   Calcul : annee_edition >= 2021
   Statut : CONFORME / NON_CONFORME / OBSOL√àTE

4. Aptitudes Frigorifiques
   R√®gle : Valide √† vie (aucune date d'expiration)
   V√©rification : Document existe et contient les informations requises
   Statut : CONFORME / NON_CONFORME

================================================================================
üì° COMMUNICATION AVEC L'API CHATGPT
================================================================================

URL API : https://chat.st.com
Port : 443 (HTTPS par d√©faut)
M√©thode : POST

Headers requis :
  Content-Type: application/json
  Authorization: Bearer <TOKEN_API>

Corps de la requ√™te (JSON) :
{
  "model": "gpt-4",
  "messages": [
    {
      "role": "system",
      "content": "Tu es un assistant d'extraction de donn√©es de documents."
    },
    {
      "role": "user",
      "content": "<PROMPT_SP√âCIFIQUE> + <CONTENU_DOCUMENT_BASE64>"
    }
  ],
  "temperature": 0.2,
  "max_tokens": 500
}

R√©ponse attendue (JSON) :
{
  "choices": [
    {
      "message": {
        "content": "{\"nom\":\"Dupont\",\"prenom\":\"Jean\",...}"
      }
    }
  ]
}

================================================================================
üìù FORMAT DU FICHIER CSV DE SORTIE
================================================================================

En-t√™te :
Entreprise,Nom,Prenom,Type_Document,Chemin_Fichier,Date_Validite,Statut,Commentaire

Exemple de lignes :
ACME Corp,Dupont,Jean,CNI,data/input/cni_dupont.pdf,2025-12-31,CONFORME,
TechnoServices,Martin,Sophie,HABILITATION,data/input/hab_martin.pdf,2023-05-15,NON_CONFORME,Expir√© depuis 2 ans
ChemLab,Durand,Pierre,FDS,data/input/fds_produit.pdf,2022,CONFORME,
ElectroPro,Bernard,Marie,APTITUDE_FRIGO,data/input/apt_bernard.pdf,N/A,CONFORME,Valide √† vie

================================================================================
üîß MAKEFILE (COMPILATION)
================================================================================

CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -g
LIBS = -lcurl -lcjson

SRCS = main.c document_scanner.c chatgpt_client.c json_parser.c validator.c excel_generator.c
OBJS = $(SRCS:.c=.o)
TARGET = pdp_automation

all: $(TARGET)

$(TARGET): $(OBJS)
	$(CC) $(CFLAGS) -o $@ $^ $(LIBS)

%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	rm -f $(OBJS) $(TARGET)

run:
	./$(TARGET)

.PHONY: all clean run

================================================================================
üöÄ COMMANDES POUR EX√âCUTER LE PROJET
================================================================================

1. Compiler le projet :
   $ make

2. Ex√©cuter le programme :
   $ make run
   OU
   $ ./pdp_automation

3. Nettoyer les fichiers compil√©s :
   $ make clean

4. Recompiler depuis z√©ro :
   $ make clean && make

================================================================================
‚ö†Ô∏è GESTION DES ERREURS
================================================================================

Le programme doit g√©rer les erreurs suivantes :

1. Erreurs de fichiers :
   - Fichier introuvable
   - Fichier corrompu
   - Permissions insuffisantes
   ‚Üí Action : Logger l'erreur dans CSV avec statut "ERREUR"

2. Erreurs r√©seau :
   - API inaccessible
   - Timeout de connexion
   - R√©ponse HTTP != 200
   ‚Üí Action : R√©essayer 3 fois, puis logger l'erreur

3. Erreurs de parsing JSON :
   - JSON malform√©
   - Champs manquants
   ‚Üí Action : Logger l'erreur avec statut "ERREUR_PARSING"

4. Erreurs m√©moire :
   - malloc() √©choue
   - D√©passement de buffer
   ‚Üí Action : Afficher erreur et arr√™ter le programme

================================================================================
üìà STATISTIQUES AFFICH√âES EN FIN D'EX√âCUTION
================================================================================

Exemple de sortie console :

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë      RAPPORT PDP AUTOMATION - 27/11/2025         ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Total de fichiers trait√©s      : 45              ‚ïë
‚ïë Documents CONFORMES             : 38              ‚ïë
‚ïë Documents NON CONFORMES         : 5               ‚ïë
‚ïë Erreurs de traitement           : 2               ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Taux de conformit√©              : 84.4%           ‚ïë
‚ïë Temps d'ex√©cution               : 2m 34s          ‚ïë
‚ïë Fichier g√©n√©r√©                  : rapport_pdp_20251127.csv
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

================================================================================
‚ú® PROCHAINES √âTAPES
================================================================================

1. Cr√©er l'architecture compl√®te du projet avec tous les fichiers
2. Impl√©menter chaque module individuellement
3. D√©finir pr√©cis√©ment les prompts pour l'IA ChatGPT
4. Tester avec des documents r√©els
5. Optimiser les performances (multithreading si n√©cessaire)
6. Ajouter une interface CLI pour param√©trer l'ex√©cution

================================================================================
üìå NOTES IMPORTANTES
================================================================================

‚Ä¢ Le port 443 sera utilis√© par d√©faut pour toutes les connexions HTTPS
‚Ä¢ L'URL de l'API ChatGPT de ST est : https://chat.st.com
‚Ä¢ Les prompts IA doivent √™tre pr√©cis et structur√©s (agissent comme des "lois")
‚Ä¢ Le programme doit √™tre robuste et continuer m√™me en cas d'erreur sur un fichier
‚Ä¢ La modularit√© est essentielle pour la maintenance future
‚Ä¢ Utiliser malloc()/free() proprement pour √©viter les fuites m√©moire

================================================================================
FIN DU DOCUMENT
================================================================================
